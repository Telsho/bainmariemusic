<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="styles.css">
  <title>Bain Marie Music</title>
  </head>

<body>
  <div id="splash" onclick="this.classList.add('hide')" class="hide">
  </div>

  <div class="map-container">
    <div id="map">
      <img src="full_frame.gif" id="home-animated" alt="Animated Map">
      <img src="MUSIC_hover.png" id="music-hover-overlay" alt="Music Area Hover">
      <img src="MERCH_hover.png" id="merch-hover-overlay" alt="Merch Area Hover">
      <img src="CONTACT_hover.png" id="contact-hover-overlay" alt="Contact Area Hover">
    </div>

    <div id="contact-info">
        <p>bainmarie.music@gmail.com</p>
        <button id="back-button">&larr; Back</button>
    </div>
  </div>

  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script>
    console.log("Script start");

    // --- Panning Logic Removed ---
    // Functions initializePanning, disablePanning, updatePanningBasedOnSize removed.
    // isPanInitialized flag removed.
    // Resize listener related to panning removed.

    // Cache container selector - still needed for contact view class
    const $mapContainer = $('.map-container');
    // Cache map selector - might still be used indirectly or for styling
    const $map = $('#map');

    // --- Document Ready ---
    $(document).ready(function () {
      console.log("Document ready");

      const $gif = $('#home-animated');
      const $contactInfo = $('#contact-info');
      const $backButton = $('#back-button');

      // --- Define ALL Hotspots and their corresponding Overlay Selectors ---
      const hotspots = [
        { name: 'music', overlaySelector: '#music-hover-overlay', xMin: 60, xMax: 290, yMin: 400, yMax: 480 },
        { name: 'merch', overlaySelector: '#merch-hover-overlay', xMin: 540, xMax: 750, yMin: 140, yMax: 210 },
        { name: 'contact', overlaySelector: '#contact-hover-overlay', xMin: 515, xMax: 800, yMin: 675, yMax: 735 }
        // Add more objects here for additional hotspots if needed
      ];

      // Find the contact hotspot data
      const contactHotspot = hotspots.find(spot => spot.name === 'contact');
      if (!contactHotspot) {
        console.error("Contact hotspot data not found in the hotspots array!");
        // Handle error appropriately, maybe disable click functionality
      }

      // --- Cache Overlay jQuery Objects ---
      const $overlays = {};
      let allElementsFound = true;

      hotspots.forEach(spot => {
        $overlays[spot.overlaySelector] = $(spot.overlaySelector);
        if ($overlays[spot.overlaySelector].length === 0) {
          console.error(`Overlay element (${spot.overlaySelector}) not found in HTML!`);
          allElementsFound = false;
        }
      });

      // Check for other essential elements
      if ($gif.length === 0) {
        console.error("GIF element #home-animated not found!");
        allElementsFound = false;
      }
      if ($contactInfo.length === 0) {
        console.error("Contact info element #contact-info not found!");
        allElementsFound = false;
      }
      if ($backButton.length === 0) {
        console.error("Back button element #back-button not found!");
        allElementsFound = false;
      }
       if ($mapContainer.length === 0) { // Keep check for mapContainer
           console.error("Map container element .map-container not found!");
           allElementsFound = false;
       }


      // --- Initial Panning Check Removed ---

      // --- Resize Listener Removed ---

      // --- Setup Effects only if all elements exist ---
      if (allElementsFound) {

        // --- Hover Effect Logic ---
        $gif.on('mousemove', function (event) {
          // Don't show hover effects if contact info is visible
          if ($mapContainer.hasClass('contact-view-active')) {
            return;
          }

          const gifOffset = $gif.offset();
          // Calculation remains the same relative to the static GIF
          const mouseX = event.pageX - gifOffset.left;
          const mouseY = event.pageY - gifOffset.top;

          let activeOverlaySelector = null; // Track active hover

          hotspots.forEach(spot => {
            const isInside = (mouseX >= spot.xMin && mouseX <= spot.xMax && mouseY >= spot.yMin && mouseY <= spot.yMax);
            if (isInside) {
              activeOverlaySelector = spot.overlaySelector;
            }
          });

          // Show/hide overlays based on hover
          hotspots.forEach(spot => {
            const $overlay = $overlays[spot.overlaySelector];
            if (spot.overlaySelector === activeOverlaySelector) {
              $overlay.show();
            } else {
              $overlay.hide();
            }
          });
        });

        // --- Mouse Leave Logic for Hover ---
        $gif.on('mouseleave', function () {
          // Hide ALL overlays when mouse leaves the GIF
          hotspots.forEach(spot => {
            $overlays[spot.overlaySelector].hide();
          });
        });

        // --- Click Logic for Contact ---
        $gif.on('click', function (event) {
          // Don't do anything if contact is already shown
          if ($mapContainer.hasClass('contact-view-active') || !contactHotspot) {
            return;
          }

          const gifOffset = $gif.offset(); // Recalculate offset on click
          const clickX = event.pageX - gifOffset.left;
          const clickY = event.pageY - gifOffset.top;

          // Check if click is within the CONTACT hotspot
          const isInsideContact = (
            clickX >= contactHotspot.xMin && clickX <= contactHotspot.xMax &&
            clickY >= contactHotspot.yMin && clickY <= contactHotspot.yMax
          );

          if (isInsideContact) {
            console.log("Contact area clicked!");

            // 1. Disable Panning - REMOVED
            // disablePanning();

            // 2. Hide all hover overlays explicitly
            hotspots.forEach(spot => {
              $overlays[spot.overlaySelector].hide();
            });

            // This might still be needed depending on your CSS animation/layout
            $mapContainer.css('overflow', 'visible');

            // 3. Add animation classes
            $mapContainer.addClass('contact-view-active'); // Add state to container
            $gif.addClass('gif-animate-forward');

          } else {
            console.log("Clicked outside contact area.");
          }
        });

        // --- Back Button Click Logic ---
        $backButton.on('click', function () {
          console.log("Back button clicked!");

          // 1. Remove animation classes
          $gif.removeClass('gif-animate-forward');
          $mapContainer.removeClass('contact-view-active');

          // 2. Re-evaluate panning based on window size - REMOVED
          // setTimeout(updatePanningBasedOnSize, 50);

        });

      } else {
        console.error("Essential elements missing. Hover and click effects setup aborted.");
      }

    }); // End Document Ready

    console.log("Script end");

  </script>
</body>

</html>